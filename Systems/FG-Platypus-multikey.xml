<?xml version="1.0"?>

<!--
	This file defines vi-like key sequences which are started with the ':'-key.
	It's evaluated by $FG_ROOT/Nasal/multikey.nas.

	- <Esc> always aborts.
	- <Return>/<Enter> executes and terminates the command mode, given that
	  <binding>s exist (use "null" if there's nothing else to do) and <no-exit/>
	  isn't defined.
	- Keys with defined <exit/> property execute their bindings immediately,
	  that is: without having to press <Return>/<Enter>.
	- Format placeholder values are available to Nasal code via arg[].
	- Nasal code can set the dialog title by assignment to the _ variable.
	- <key> indices aren't used by the system, but are recommended to allow
	  reliable overwriting by aircraft or user xml files.
	- Cursor keys are equivalent to characters <, >, ^, _.
-->

<PropertyList>
	<nasal>
		<script><![CDATA[
			var clamp = func(val, min, max) {
				return (val > max) ? max : (val < min) ? min : val;
			}

			var adjustprop = func(path, offset, min = -1, max = 1) {
				var val = getprop(path) + offset;
				setprop(path, clamp(val, min, max));
				return val;
			}

			# Usage: setpropf(<format>, <vector or list of args>, <value>);
			var setpropf = func {
				var val = pop(arg);
				setprop(call(sprintf, size(arg) and typeof(arg[0]) == "vector" ? arg[0] : arg), val);
			}

			# Usage: getpropf(<format>, <vector or list of args>);
			var getpropf = func {
				getprop(call(sprintf, size(arg) and typeof(arg[0]) == "vector" ? arg[0] : arg));
			}
			
			var radio_fmt = "/instrumentation/%s[%u]/frequencies/%s-mhz";

			var setfreq = func(type, index, which, value) {
				index = (index >= 1) ? index - 1 : 0;
				setpropf(radio_fmt, type, index, which, value);
			}

			var togglefreq = func(type, index) {
				index = (index >= 1) ? index - 1 : 0;
				var sel = sprintf(radio_fmt, type, index, "selected");
				var stby = sprintf(radio_fmt, type, index, "standby");
				var s = getprop(stby);
				setprop(stby, getprop(sel));
				setprop(sel, s);
			}

			var settacan = func(number, letter) {
				var ch = sprintf("%03u%s", number, letter);
				var p = "/instrumentation/tacan/frequencies/selected-channel[%u]";
				setpropf(p, 1, chr(ch[0]));
				setpropf(p, 2, chr(ch[1]));
				setpropf(p, 3, chr(ch[2]));
				setpropf(p, 4, chr(ch[3]));
			}
		]]></script>
	</nasal>

	<key n="97">
		<name>a</name>
		<desc>M-Key Menu</desc><!-- reserved for aircraft extensions -->
		
			
		<key n="97">  <!--autopilot settings-->
			<name>a</name>
			<desc>Auto Pilot</desc>

			<key n="97">
				<name>a</name>
				<desc>AP On Off</desc>
				<exit/>
				<binding>
					<condition>
						<not>
						<property>gear/gear/wow</property>
						</not>
					</condition>	
						<command>property-cycle</command>
						<property>it-autoflight/input/ap</property>
						<value>1</value>
						<value>0</value>
				</binding>
			</key>

			<key n="104">
				<name>h</name>
				<desc>Toggle HDG/Roll</desc>
				<exit/>
				<binding>
					<command>nasal</command>
					<script>
						kap140.btnHDG();
					</script>
				</binding>
			</key>

			<key n="98">
				<name>b</name>
				<desc>Set Heading Bug</desc>
				<key n="901">
					<name>%f</name>
					<desc>Heading Bug = %.3f degree</desc>
					<binding>
						<command>nasal</command>
						<script>							
							setprop("/it-autoflight/input/hdg", arg[0]);
						</script>
					</binding>
				</key>
			</key>
			
			<key n="103">
				<name>g</name>
				<desc>GS App Mode</desc>
				<exit/>
				<binding>
					<command>nasal</command>
						<script>
							kap140.btnAPR();
						</script>
				</binding>
			</key>

			<key n="105">
				<name>i</name>
				<desc>Display ITAF</desc>
				<exit/>
				<binding>		
					<command>nasal</command>
					<script>libraries.ita();</script>
				</binding>
			</key>
			
			<key n="110">
				<name>n</name>
				<desc>Nav VOR Mode</desc>
				<exit/>
				<binding>
				<command>nasal</command>
					<script>
						kap140.btnNAV();
					</script>
				</binding>
			</key>

			<key n="115">
				<name>s</name>
				<desc>Set Nav Source N1 N2 GPS)</desc>
				<exit/>
				<binding>
					<command>property-cycle</command>
					<property>options/nav-source</property>
						<value>1</value>
						<value>3</value>
						<value>2</value>
				</binding>
			</key>
			
			<key n="119">
				<name>w</name>
				<desc>Set Roll Mode</desc>
				<exit/>
				<binding>
					<command>nasal</command>
					<script>				
						kap140.btnHDG();
					</script>
				</binding>
			</key>

		</key>

		<!--dialogs-->
		<key n="100">  
			<name>d</name>
			<desc>Dialogs</desc>

			<key n="115">
				<name>s</name>
				<desc>tba</desc>
				<exit/>
				<binding>
					<command>property-assign</command>
					<property>sim/hud/visibility[0]</property>
					<value>0</value>
				</binding>
				<binding>
					<command>property-toggle</command>
					<property>sim/model/f-14b/controls/hud/on-off</property>
				</binding>
			</key>

			<!-- Mode -->
			<key n="116">
				<name>t</name>
				<desc>tba</desc>
				<exit/>
				<binding>
					<command>nasal</command>
					<script>f14_instruments.sel_displays_main_mode("sim/model/f-14b/controls/pilots-displays/mode", "to-bt")</script>
				</binding>
			</key>

			<key n="99">
				<name>c</name>
				<desc>tba</desc>
				<exit/>
				<binding>
					<command>nasal</command>
					<script>f14_instruments.sel_displays_main_mode("sim/model/f-14b/controls/pilots-displays/mode", "cruise-bt")</script>
				</binding>
			</key>

			<key n="97">
				<name>a</name>
				<desc>Testing</desc>
				<exit/>
				<binding>
					<command>dialog-show</command>
	<dialog-name>dash</dialog-name>
    </binding>
    <binding>
	<command>dialog-show</command>
	<dialog-name>dpresets</dialog-name>
    </binding>
	<binding>
	<command>dialog-show</command>
	<dialog-name>qreset</dialog-name>
    </binding>
    	<binding>
	<command>property-assign</command>
	<property>/sim/hud/visibility[1]</property>
	<value>true</value>					
    </binding>
	<binding>
		<command>nasal</command>
						<script>
	if (getprop("/systems/vbo")== 1) {
				fgcommand("dialog-close", props.Node.new({ "dialog-name" : "viewBarWarrior_h" }));		
		setprop("/systems/vbo",0);		
	}
	else {
		setprop("/systems/vbo",1);
		var vw =getprop("/sim/current-view/view-number");	
		 setprop("/sim/current-view/view-number",vw); 
	}

	setprop("/sim/gui/dialogs/viewBarWarrior_h/dialog/x",1);
	setprop("/sim/gui/dialogs/viewBarWarrior_h/dialog/y",1);
	
	fgcommand("dialog-show", props.Node.new({ "dialog-name" : "viewBarWarrior_h" }));

						</script>
						</binding>	

    <binding>
	<command>property-assign</command>
	<property>/controls/switches/panel-lights-factor</property>
	<value>1</value>					
    </binding>

			</key>

			<key n="103">
				<name>g</name>
				<desc>tba</desc>
				<exit/>
				<binding>
					<command>nasal</command>
					<script>f14_instruments.sel_displays_main_mode("sim/model/f-14b/controls/pilots-displays/mode", "ag-bt")</script>
				</binding>
			</key>

			<key n="108">
				<name>l</name>
				<desc>HUD Landing mode</desc>
				<exit/>
				<binding>
					<command>nasal</command>
					<script>f14_instruments.sel_displays_main_mode("sim/model/f-14b/controls/pilots-displays/mode", "ldg-bt")</script>
				</binding>
			</key>

		</key>
		
		<!--sub3-->
		<key n="101">  
			<name>e</name>
			<desc>Environment</desc>

			<key n="115">
				<name>s</name>
				<desc>tba</desc>
				<exit/>
				<binding>
					<command>property-assign</command>
					<property>sim/hud/visibility[0]</property>
					<value>0</value>
				</binding>
				<binding>
					<command>property-toggle</command>
					<property>sim/model/f-14b/controls/hud/on-off</property>
				</binding>
			</key>

			<!-- Mode -->
			<key n="116">
				<name>t</name>
				<desc>tba</desc>
				<exit/>
				<binding>
					<command>nasal</command>
					<script>f14_instruments.sel_displays_main_mode("sim/model/f-14b/controls/pilots-displays/mode", "to-bt")</script>
				</binding>
			</key>

			<key n="99">
				<name>c</name>
				<desc>tba</desc>
				<exit/>
				<binding>
					<command>nasal</command>
					<script>f14_instruments.sel_displays_main_mode("sim/model/f-14b/controls/pilots-displays/mode", "cruise-bt")</script>
				</binding>
			</key>

			<key n="97">
				<name>a</name>
				<desc>Testing</desc>
				<exit/>
				<binding>
					<command>dialog-show</command>
	<dialog-name>dash</dialog-name>
    </binding>
    <binding>
	<command>dialog-show</command>
	<dialog-name>dpresets</dialog-name>
    </binding>
	<binding>
	<command>dialog-show</command>
	<dialog-name>qreset</dialog-name>
    </binding>
    	<binding>
	<command>property-assign</command>
	<property>/sim/hud/visibility[1]</property>
	<value>true</value>					
    </binding>
	<binding>
		<command>nasal</command>
						<script>
	if (getprop("/systems/vbo")== 1) {
				fgcommand("dialog-close", props.Node.new({ "dialog-name" : "viewBarWarrior_h" }));		
		setprop("/systems/vbo",0);		
	}
	else {
		setprop("/systems/vbo",1);
		var vw =getprop("/sim/current-view/view-number");	
		 setprop("/sim/current-view/view-number",vw); 
	}

	setprop("/sim/gui/dialogs/viewBarWarrior_h/dialog/x",1);
	setprop("/sim/gui/dialogs/viewBarWarrior_h/dialog/y",1);
	
	fgcommand("dialog-show", props.Node.new({ "dialog-name" : "viewBarWarrior_h" }));

						</script>
						</binding>	

    <binding>
	<command>property-assign</command>
	<property>/controls/switches/panel-lights-factor</property>
	<value>1</value>					
    </binding>

			</key>

			<key n="103">
				<name>g</name>
				<desc>tba</desc>
				<exit/>
				<binding>
					<command>nasal</command>
					<script>f14_instruments.sel_displays_main_mode("sim/model/f-14b/controls/pilots-displays/mode", "ag-bt")</script>
				</binding>
			</key>

			<key n="108">
				<name>l</name>
				<desc>HUD Landing mode</desc>
				<exit/>
				<binding>
					<command>nasal</command>
					<script>f14_instruments.sel_displays_main_mode("sim/model/f-14b/controls/pilots-displays/mode", "ldg-bt")</script>
				</binding>
			</key>

		</key>
		
<!-- Radio sub4-->
	<nasal>
		<script>
			var radio_fmt = "/instrumentation/%s[%u]/frequencies/%s-mhz";

			var setfreq = func(type, index, which, value) {
				index = (index >= 1) ? index - 1 : 0;
				setpropf(radio_fmt, type, index, which, value);
			}

			var togglefreq = func(type, index) {
				index = (index >= 1) ? index - 1 : 0;
				var sel = sprintf(radio_fmt, type, index, "selected");
				var stby = sprintf(radio_fmt, type, index, "standby");
				var s = getprop(stby);
				setprop(stby, getprop(sel));
				setprop(sel, s);
			}

			var settacan = func(number, letter) {
				var ch = sprintf("%03u%s", number, letter);
				var p = "/instrumentation/tacan/frequencies/selected-channel[%u]";
				setpropf(p, 1, chr(ch[0]));
				setpropf(p, 2, chr(ch[1]));
				setpropf(p, 3, chr(ch[2]));
				setpropf(p, 4, chr(ch[3]));
			}
		</script>
	</nasal>

	<key n="102">
		<name>f</name>
		<desc>Frequencies</desc>

		<key n="97">
			<name>a</name>
			<desc>ADF</desc>
			<key n="102">
				<name>f</name>
				<desc>ADF frequency = ? kHz</desc>
				<key n="902">
					<name>%u</name>
					<desc>ADF frequency = %u kHz</desc>
					<binding>
						<command>nasal</command>
						<script>setprop("/instrumentation/adf[0]/frequencies/selected-khz", arg[0])</script>
					</binding>
				</key>
			</key>
		</key>

		<key n="99">
			<name>c</name>
			<desc>Comm</desc>
			<key n="902">
				<name>%u</name>
				<desc>Comm%u</desc>
				<key n="102">
					<name>f</name>
					<desc>Comm%u frequency = ? MHz</desc>
					<key n="37">
						<name>%f</name>
						<desc>Comm%u frequency = %.3f MHz</desc>
						<binding>
							<command>nasal</command>
							<script>setfreq("comm", arg[0], "selected", arg[1])</script>
						</binding>
					</key>
				</key>

				<key n="115">
					<name>s</name>
					<desc>Comm%u standby frequency = ? MHz</desc>
					<key n="901">
						<name>%f</name>
						<desc>Comm%u standby frequency = %.3f MHz</desc>
						<binding>
							<command>nasal</command>
							<script>setfreq("comm", arg[0], "standby", arg[1])</script>
						</binding>
					</key>
				</key>

				<key n="116">
					<name>t</name>
					<desc>Comm%u toggle selected/standby</desc>
					<binding>
						<command>nasal</command>
						<script>togglefreq("comm", arg[0])</script>
					</binding>
				</key>
			</key>
		</key>

		<key n="110">
			<name>n</name>
			<desc>Nav</desc>
			<key n="902">
				<name>%u</name>
				<desc>Nav%u</desc>
				<key n="102">
					<name>f</name>
					<desc>Nav%u frequency = ? MHz</desc>
					<key n="901">
						<name>%f</name>
						<desc>Nav%u frequency = %.3f MHz</desc>
						<binding>
							<command>nasal</command>
							<script>setfreq("nav", arg[0], "selected", arg[1])</script>
						</binding>
					</key>
				</key>

				<key n="115">
					<name>s</name>
					<desc>Nav%u standby frequency = ? MHz</desc>
					<key n="901">
						<name>%f</name>
						<desc>Nav%u standby frequency = %.3f MHz</desc>
						<binding>
							<command>nasal</command>
							<script>setfreq("nav", arg[0], "standby", arg[1])</script>
						</binding>
					</key>
				</key>

				<key n="116">
					<name>t</name>
					<desc>Nav%u toggle selected/standby</desc>
					<binding>
						<command>nasal</command>
						<script>togglefreq("nav", arg[0])</script>
					</binding>
				</key>
			</key>
		</key>

		<key n="116">
			<name>t</name>
			<desc>TACAN channel = ?</desc>
			<key n="902">
				<name>%3u</name>
				<desc>TACAN channel = %u</desc>
				<key n="120">
					<name>x</name>
					<desc>TACAN channel = %uX</desc>
					<binding>
						<command>nasal</command>
						<script>settacan(arg[0], "X")</script>
					</binding>
				</key>

				<key n="121">
					<name>y</name>
					<desc>TACAN channel = %uY</desc>
					<binding>
						<command>nasal</command>
						<script>settacan(arg[0], "Y")</script>
					</binding>
				</key>
			</key>
		</key>
	</key>

		
			<!-- sub5 -->
		<key n="114">
			<name>r</name>
			<desc>Route Manager</desc>
			<binding>
				<command>null</command>
			</binding>

			<key n="99">
				<name>c</name>
				<desc>UHF set Channel</desc>
				<key n="60">
					<name>&gt;</name>
					<desc>UHF set Channel up</desc>
					<no-exit/>
					<binding>
						<command>nasal</command>
						<script>_ = sprintf("Chan %02u Freq %3f", an_arc_159v1.adj_channel(1), an_arc_159v1.get_selected())</script>
					</binding>


				</key>
				<key n="62">
					<name>&lt;</name>
					<desc>UHF set Channel down</desc>
					<no-exit/>
					<binding>
						<command>nasal</command>
						<script>_ = sprintf("Chan %02u Freq %3f", an_arc_159v1.adj_channel(-1), an_arc_159v1.get_selected())</script>
					</binding>
				</key>

				<key n="102">
					<name>f</name>
					<desc>UHF change Channel Frequency = ? kHz (225000-400000)</desc>
					<key n="902">
						<name>%u</name>
						<desc>UHF frequency = %u kHz</desc>
						<binding>
							<command>nasal</command>
							<script>an_arc_159v1.set_freq(arg[0]); an_arc_159v1.load(arg[0])</script>
						</binding>
					</key>
				</key>
			</key>

			<key n="111">
				<name>o</name>
				<desc>UHF set Function PRESET - Mode MAIN</desc>
				<binding>
					<command>nasal</command>
					<script>an_arc_159v1.Mode.setValue(1); an_arc_159v1.turn_on(); an_arc_159v1.Function.setValue(0);</script>
				</binding>
			</key>
			<key n="47">
				<name>/</name>
				<desc>UHF set Mode OFF</desc>
				<binding>
					<command>nasal</command>
					<script>an_arc_159v1.Mode.setValue(0); an_arc_159v1.turn_off()</script>
				</binding>
			</key>
		</key>
		
			<!-- sub6 -->
		<key n="117">
			<name>u</name>
			<desc>Utilities</desc>
			<binding>
				<command>null</command>
			</binding>

			<key n="99">
				<name>c</name>
				<desc>UHF set Channel</desc>
				<key n="60">
					<name>&gt;</name>
					<desc>UHF set Channel up</desc>
					<no-exit/>
					<binding>
						<command>nasal</command>
						<script>_ = sprintf("Chan %02u Freq %3f", an_arc_159v1.adj_channel(1), an_arc_159v1.get_selected())</script>
					</binding>


				</key>
				<key n="62">
					<name>&lt;</name>
					<desc>UHF set Channel down</desc>
					<no-exit/>
					<binding>
						<command>nasal</command>
						<script>_ = sprintf("Chan %02u Freq %3f", an_arc_159v1.adj_channel(-1), an_arc_159v1.get_selected())</script>
					</binding>
				</key>

				<key n="102">
					<name>f</name>
					<desc>UHF change Channel Frequency = ? kHz (225000-400000)</desc>
					<key n="902">
						<name>%u</name>
						<desc>UHF frequency = %u kHz</desc>
						<binding>
							<command>nasal</command>
							<script>an_arc_159v1.set_freq(arg[0]); an_arc_159v1.load(arg[0])</script>
						</binding>
					</key>
				</key>
			</key>

			<key n="111">
				<name>o</name>
				<desc>UHF set Function PRESET - Mode MAIN</desc>
				<binding>
					<command>nasal</command>
					<script>an_arc_159v1.Mode.setValue(1); an_arc_159v1.turn_on(); an_arc_159v1.Function.setValue(0);</script>
				</binding>
			</key>
			<key n="47">
				<name>/</name>
				<desc>UHF set Mode OFF</desc>
				<binding>
					<command>nasal</command>
					<script>an_arc_159v1.Mode.setValue(0); an_arc_159v1.turn_off()</script>
				</binding>
			</key>
		</key>

				
	</key>

</PropertyList>
